<!DOCTYPE html>
<!--
Copyright (c) 2015 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="/model/counter.html">
<link rel="import" href="/model/counter_series.html">
<link rel="import" href="/model/model.html">

<script>
'use strict';

tr.b.unittest.testSuite(function() {

  var Counter = tr.model.Counter;
  var CounterSeries = tr.model.CounterSeries;
  var Device = tr.model.Device;
  var Model = tr.Model;

  test('updateBounds', function() {
    var device = new Device(new Model());
    device.powerCounter = new Counter(device, 'a.B', 'a', 'B');

    // Verify that the bounds match the lowest and highest counter sample
    // timestamps
    var series = new CounterSeries('a', 0);
    device.powerCounter.addSeries(series);
    series.addCounterSample(100, 5);
    series.addCounterSample(200, 5);

    device.updateBounds();

    assert.equal(device.bounds.min, 100);
    assert.equal(device.bounds.max, 200);

    // Add a new sample and verify that the bounds change
    series.addCounterSample(700, 5);

    device.updateBounds();

    assert.equal(device.bounds.max, 700);
 });

  test('shiftTimestampsForward', function() {
    var device = new Device(new Model());

    device.powerCounter = new Counter(device, 'a.B', 'a', 'B');

    var series = new CounterSeries('a', 0);
    device.powerCounter.addSeries(series);
    series.addCounterSample(100, 5);
    series.addCounterSample(200, 5);

    device.shiftTimestampsForward(5);

    assert.equal(device.powerCounter.series[0].samples[0].timestamp, 105);
    assert.equal(device.powerCounter.series[0].samples[1].timestamp, 205);
  });

  test('addCategoriesToDict', function() {
    var device = new Device(new Model());

    device.powerCounter = new Counter(device, 'a.B', 'a', 'B');

    var expectedDict = { 'a': true };
    var actualDict = {};
    device.addCategoriesToDict(actualDict);

    assert.deepEqual(actualDict, expectedDict);
  });

  test('iterateAllChildEventContainers', function() {
    var device = new Device(new Model());

    // Shouldn't iterate over anything until we set the power counter
    var expectedIds = [];
    var actualIds = [];
    device.iterateAllChildEventContainers(function(child) {
      actualIds.push(child.id);
    });

    assert.deepEqual(actualIds, expectedIds);

    // Should include the power counter after we set it
    device.powerCounter = new Counter(device, 'a.B', 'a', 'power');

    var expectedIds = ['a.B'];
    var actualIds = [];
    device.iterateAllChildEventContainers(function(child) {
      actualIds.push(child.id);
    });

    assert.deepEqual(actualIds, expectedIds);
  });
});
</script>
