<!DOCTYPE html>
<!--
Copyright (c) 2013 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="/ui/tracks/container_track.html">
<link rel="import" href="/ui/tracks/counter_track.html">
<link rel="import" href="/ui/tracks/spacing_track.html">

<style>
#powerTrack {
  height: 90px;
}
</style>

<script>
'use strict';

tr.exportTo('tr.ui.tracks', function() {

  var ContainerTrack = tr.ui.tracks.ContainerTrack;
  var SpacingTrack = tr.ui.tracks.SpacingTrack;

  // TODO(charliea): Make this track collapsible
  /**
   * Track to visualize the device model.
   * @constructor
   */
  var DeviceTrack = tr.ui.b.define('device-track', ContainerTrack);
  var POWER_TRACK_ID = 'powerTrack';

  DeviceTrack.prototype = {

    __proto__: ContainerTrack.prototype,

    decorate: function(viewport) {
      ContainerTrack.prototype.decorate.call(this, viewport);
      this.device_ = null;
    },

    get device() {
      return this.device_;
    },

    set device(device) {
      this.device_ = device;
      this.updateContents_();
    },

    get hasVisibleContent() {
      return (this.device_.powerCounter != null);
    },

    addContainersToTrackMap: function(containerToTrackMap) {
      containerToTrackMap.addContainer(this.device, this);
    },

    addEventsToTrackMap: function(eventToTrackMap) {
      this.tracks_.forEach(function(track) {
        track.addEventsToTrackMap(eventToTrackMap);
      });
    },

    appendCounterTracks_: function() {
      if (this.device_.powerCounter != null) {
        var track = new tr.ui.tracks.CounterTrack(this.viewport);
        track.counter = this.device_.powerCounter;
        track.id = POWER_TRACK_ID;
        this.appendChild(track);
        this.appendChild(new SpacingTrack(this.viewport));
      }
    },

    clearTracks_: function() {
      this.tracks_.forEach(function(track) {
        this.removeChild(track);
      }, this);
    },

    updateContents_: function() {
      this.clearTracks_();
      this.appendCounterTracks_();
    }
  };

  return {
    DeviceTrack: DeviceTrack
  };
});
</script>
